# NebulaAI

A work in progress AI bot for Discord.

# Features

- Local (or remote) LLM interfacing with OpenAI compatible APIs (such as Ollama)
- Voice message transcription with OpenAI Whisper
- Plugins for LLM interfacing
    - Image Generation: Use [fastsdcpu](https://github.com/rupeshs/fastsdcpu) to generate images on CPU (automatically spoilered on Discord)
    - Image Processing: Use a vision model with Ollama to process images sent in Discord
    - Reddit: Give an LLM information about a Reddit post
    - Shell: Generate and run commands to run in an Alpine Linux shell
    - Twitter: Work in progress (Goal: Ask about a user, or automatially summarize content and comments of a post)
    - Web: Search DuckDuckGo and scrape information from the top results
    - YouTube: Summarize a YouTube video using Whisper
- Blacklist users
- Update base system prompt, models, and base URL with commands on the fly
- Run Python code generated by the LLM in a container
- Owner only commands
- Convert units from a message or through a slash command
- Summarize a message

# Requirements

- Local or remote machine running:
    - [Ollama](https://ollama.com) (or modify code to use another OpenAI compatible API)
    - [fastsdcpu](https://github.com/rupeshs/fastsdcpu) web server
    - The base Whisper model will be automatically downloaded to `$HOME/.cache/whisper/base.pt`
- **\[Shell plugin + Python running\]** Docker host
    - **!! WARNING:** The shell plugin should be secure enough, but make sure you take the steps to harden your (virtual) machine. The contributors of NebulaAI are not responsible for damages from potential security issues.
    - A [gluetun](https://github.com/qdm12/gluetun) VPN container will be used for every new container. This can be changed in the code.
    - Build the necessary containers in the `containers` directory, and tag them with `ai-` followed by the folder name (ex. `ai-ssh`)
    - Requires an SSH key in `config/docker.pem`
- **\[Web plugin\]** Optional proxies for DuckDuckGo searches and web scraping

# Setup

1. Install Python 3.12 and Poetry
2. Copy `.env.example` to `.env`, and fill in the information
3. Copy `config/config.json.example` to `config/config.json`, and fill in the information
    - **\[Reddit plugin\]** A Reddit app can be created from [here](https://old.reddit.com/prefs/apps)
4. Copy `config/ai.json.example` to `config/ai.json`
    - All information here can be updated with Discord slash commands in the `/ai` group
5. **\[Shell plugin + Python running\]** Add an SSH key for your Docker host to `config/docker.pem`
6. **\[Web plugin\]** Add proxies to `config/proxies.txt`
7. Run `poetry install`
8. Start the bot with `poetry run python main.py`
9. In a channel the bot has access to, run `{prefix}sync guild` to sync all commands to your server

# Code that you may want to change

- Enabled plugins may be edited in the `self.plugins` array in `cogs/ai.py`
    - Plugins will be used in order, Web Search should usually be the last
- Docker commands can be changed in `utils/containers.py`
- Prompts for plugins can be changed in the markdown files in `config/prompts`
- Eval command is owner only, but is in `cogs/owner.py` and can be removed if you would like

# Other information

<details>
<summary>Credits</summary>
<br>
- [stekc/Keto-Bot](https://github.com/stekc/Keto-Bot)
- [DiscordGIR/GIRRewrite](https://github.com/DiscordGIR/GIRRewrite)
- [Hardening script for Alpine Docker containers](https://gist.github.com/jumanjiman/f9d3db977846c163df12)
- [Eval command](https://gist.github.com/simmsb/2c3c265813121492655bc95aa54da6b9)
- Various other sources. If I forgot to credit you, let me know!
</details>
